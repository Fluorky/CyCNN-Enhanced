services:
  cycnn-gpu:
    build:
      context: .
      dockerfile: Dockerfile
    image: cycnn:gpu
    container_name: cycnn-gpu
    working_dir: /app/cycnn
    command: ["python", "main.py", "--help"]
    volumes:
      - ./cycnn/logs:/app/cycnn/logs
      - ./cycnn/saves:/app/cycnn/saves
      - ./data:/app/cycnn/data
    # Compose v2 supports this simple GPU flag:
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    # If your docker-compose doesn't support the above, you can remove deploy: and run with:
    # docker compose run --gpus all cycnn-gpu

  cycnn-cpu:
    build:
      context: .
      dockerfile: Dockerfile.cpu
    image: cycnn:cpu
    container_name: cycnn-cpu
    working_dir: /app/cycnn
    command: ["python", "main.py", "--help"]
    volumes:
      - ./cycnn/logs:/app/cycnn/logs
      - ./cycnn/saves:/app/cycnn/saves
      - ./data:/app/cycnn/data
